
<style>
  .flash-wrapper {
    display: flex;
    text-align: center;
    align-items: center;
    gap: 10px;
    justify-content: space-between;
    align-self: center;
    border: 1px solid #ddd;
    padding: 0px 10px;
    border-radius: 41px;
  }

  .flash-wrapper h1 {
    font-size: 15px;
    margin: 0px;
    padding: 0px;
  }

  .timer-wrapper {
    display: flex;
    align-items: center;
    gap: 5px;
  }

  .timer {
    padding: 0px;
  }

  p#sold {
    padding: 0px !important;
    margin: 0px !important;
  }

  p#timer {
    margin: 0px;
    color: red;
  }

  .progress-bar {
    flex-grow: 1;
    height: 10px;
    background-color: #ddd;
    border-radius: 5px;
    position: relative;
  }

  .progress-bar-inner {
    height: 100%;
    width: 20%;
    display: block !important;
    background-color: #4CAF50;
    transition: width 0.5s ease-in-out;
  }
</style>


<div class="flash-wrapper">
<div>
  <h1>{{ settings.flash_title_id }}</h1> <!-- Use Liquid variable for flash title -->
</div>
<div class="timer-wrapper">{{ settings.flash_timer_id }} <p id="timer"></p></div>
<div>
  <p id="sold">{{ settings.flash_sold_id }}</p>
</div>
<div class="progress-bar">
  <div class="progress-bar-inner"></div>
</div>
</div>

<script>
const endTime = Math.floor(Date.now() / 1000) + 60 * 60 * 24; // 24 hours from now in seconds
const timerInterval = 1000;
const timerEl = document.getElementById("timer");
const soldEl = document.getElementById("sold");
const progressBarInner = document.querySelector(".progress-bar-inner");

function formatTime(time) {
  const hours = Math.floor(time / 3600);
  const minutes = Math.floor((time % 3600) / 60);
  const seconds = time % 60;

  return `${hours.toString().padStart(2, "0")}:${minutes.toString().padStart(2, "0")}:${seconds.toString().padStart(2, "0")}`;
}

function updateTimer() {
  const remainingTime = endTime - Math.floor(Date.now() / 1000);

  if (remainingTime > 0) {
    timerEl.innerText = formatTime(remainingTime);
    const sold = 9 - Math.floor(remainingTime / 60);
    soldEl.innerText = `${Math.abs(sold)} sold`;

    const percentage = Math.min((Math.abs(sold) / 9) * 100, 100);
    progressBarInner.style.width = `${percentage}% !important`;
  } else {
    timerEl.innerText = "SALE ENDED";
    soldEl.innerText = "ALL ITEMS SOLD OUT";
    progressBarInner.style.width = "100%";
  }
}

updateTimer();
setInterval(updateTimer, timerInterval);
</script>

{% schema %}
  {
    "name": "flash-sale",
    "target": "section",
    "settings": [
      {
        "type": "select",
        "id": "Styles",
        "label": "Styles",
        "options": [
          {
            "value": "s1",
            "label": "Style 1"
          },
          {
            "value": "s2",
            "label": "Style 2"
          },
          {
            "value": "s3",
            "label": "Style 3"
          },
          {
            "value": "s4",
            "label": "Style 4"
          },
          {
            "value": "s5",
            "label": "Style 5"
          },
          {
            "value": "s6",
            "label": "Style 6"
          }
        ],
        "default": "s1"
      },
      {
        "type": "text",
        "id": "heading",
        "label": "Heading",
        "default": "Flash Sale"
      },
      {
        "type": "select",
        "id": "year",
        "label": "Year",
        "options": [
          {
            "value": "2024",
            "label": "2024"
          },
          {
            "value": "2025",
            "label": "2025"
          }
        ],
        "default": "2024"
      },
      {
        "type": "select",
        "id": "month",
        "label": "Month",
        "options": [
          {
            "value": "01",
            "label": "January"
          },
          {
            "value": "02",
            "label": "February"
          },
          {
            "value": "03",
            "label": "March"
          },
          {
            "value": "04",
            "label": "April"
          },
          {
            "value": "05",
            "label": "May"
          },
          {
            "value": "06",
            "label": "June"
          },
          {
            "value": "07",
            "label": "July"
          },
          {
            "value": "08",
            "label": "August"
          },
          {
            "value": "09",
            "label": "September"
          },
          {
            "value": "10",
            "label": "October"
          },
          {
            "value": "11",
            "label": "November"
          },
          {
            "value": "12",
            "label": "December"
          }
        ],
        "default": "02"
      },
      {
        "type": "select",
        "id": "hours",
        "label": "Hours",
        "options": [
          {
            "value": "00",
            "label": "00"
          },
          {
            "value": "01",
            "label": "01"
          },
          {
            "value": "02",
            "label": "02"
          },
          {
            "value": "03",
            "label": "03"
          },
          {
            "value": "04",
            "label": "04"
          },
          {
            "value": "05",
            "label": "05"
          },
          {
            "value": "06",
            "label": "06"
          },
          {
            "value": "07",
            "label": "07"
          },
          {
            "value": "08",
            "label": "08"
          },
          {
            "value": "09",
            "label": "09"
          },
          {
            "value": "10",
            "label": "10"
          },
          {
            "value": "11",
            "label": "11"
          },
          {
            "value": "12",
            "label": "12"
          },
          {
            "value": "13",
            "label": "13"
          },
          {
            "value": "14",
            "label": "14"
          },
          {
            "value": "15",
            "label": "15"
          },
          {
            "value": "16",
            "label": "16"
          },
          {
            "value": "17",
            "label": "17"
          },
          {
            "value": "18",
            "label": "18"
          },
          {
            "value": "19",
            "label": "19"
          },
          {
            "value": "20",
            "label": "20"
          },
          {
            "value": "21",
            "label": "21"
          },
          {
            "value": "22",
            "label": "22"
          },
          {
            "value": "23",
            "label": "23"
          }
        ],
        "default": "00"
      }
    ]
  }
  {% endschema %}
  